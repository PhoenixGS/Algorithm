# 斜率优化
有一种DP式子是长这样的（全篇用max，max可换成min）：
$$ f[i] = max\{ f[j]+cost(j+1,i) | j < i \}$$
假如能通过将一些东西移出max而将这个式子max里的东西化成
$$ Y[j] + X[j] * T[i] $$
那么将$T[i]$看成自变量，那么这个式子就是一个一次函数
而对于两个决策点$j,k$
$$ \frac{Y[j]-Y[k]}{X[j]-X[k]} $$
就是两直线交点的横坐标，当$T[i]=\frac{Y[j]-Y[k]}{X[j]-X[k]}$时，在两个决策点得到的值是相同的，不等于时，就会选择j和k中的一个。
假如原式子里是max的话，那么维护一个上凸包即可
怎么维护凸包呢？
如果有斜率递增的三条直线$l_1,l_2,l_3$，$l_1,l_2$交点的横坐标为$x_1$，$l_2,l_3$交点的横坐标为$x_2$，假如$x_1<x_2$那么就可以发现$l_2$是毫无用处的，那么删掉即可

1. 如果$X[i]$单调递增（减），那么在加入一条新的直线时，只需要维护凸包的右（左）部即可，那么只要维护一个斜率递增（减）的单调栈
    1. 如果$T[i]$也单调，也就是x坐标一直会往右（左），决策点也一直往右（左），只需将单调栈变成单调队列，i变大的时候同时维护单调队列的头部，那么最后时间复杂度可以变成$O(n)$
    2. 如果$T[i]$不单调，那么决策点就需要二分，时间复杂度$O(nlgn)$
2. 如果$X[i]$不单调，那么维护凸包就需要用一棵平衡树来维护了，时间复杂度$O(nlgn)$。有时候还可以用CDQ分治来做，需要合并两个凸包和归并排序，总的时间复杂度也是$O(nlgn)$


## 例题
1. [[NOI2007]货币兑换Cash](https://www.lydsy.com/JudgeOnline/problem.php?id=1492)
2. [[SDOI2012]任务安排](https://www.lydsy.com/JudgeOnline/problem.php?id=2726)


